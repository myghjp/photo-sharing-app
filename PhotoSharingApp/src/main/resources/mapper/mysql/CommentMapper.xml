<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="portfolio.PhotoSharingApp.repository.CommentMapper">

	<resultMap type="portfolio.PhotoSharingApp.entity.Comment" id="CommentsTable">
		<id column="id" property="id"/>
		<result column="group_id" property="groupId"/>
		<result column="comment" property="comment"/>
		<result column="account_id" property="accountId"/>
		<result column="create_date_time" property="createDateTime"/>
		<association property="account" resultMap="accountsTable" columnPrefix="accounts_"/>
	</resultMap>
	
	<resultMap type="portfolio.PhotoSharingApp.entity.Account" id="accountsTable">
		<id column="id" property="id" />
		<result column="user" property="username" />
	</resultMap>
	
	<insert id="insert">
		insert into comments(
			 group_id
			,comment
			,account_id
		)VALUES(
			 #{comment.groupId}
			,#{comment.comment}
			,#{comment.accountId}
		)
	</insert>
	
	<delete id="delete">
		delete from comments
		where id = #{commentId}
	</delete>
	
	<!-- ーーーーーーーーーーーーーーーーーーーー -->
	
	<select id="selectComments" resultMap="CommentsTable">
		select comments.id
			,accounts.user as accounts_user
			,comments.create_date_time
			,comments.comment
		from comments
			left join accounts
			on comments.account_id = accounts.id
		where comments.group_id = #{groupId}
		order by comments.id desc
	</select>
	
	<select id="selectById" resultMap="CommentsTable">
		select id,comment
		from comments
		where id = #{commentId}
	</select>
	
	<select id="selectByAccountId" resultType="Integer">
		select account_id
		from comments
		where id = #{commentId}
	</select>
	
</mapper>